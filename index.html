
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Excel - Avícola</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen">
  <header class="bg-white shadow-md p-4 sticky top-0 z-50 w-full">
    <div class="container mx-auto flex justify-between items-center px-4">
      <h1 class="text-xl font-bold">Avícola Belo Vale</h1>
      <input type="file" id="excelInput" accept=".xlsx, .xls" class="ml-auto bg-blue-100 p-2 rounded text-sm" />
    </div>
  </header>

  <section id="graficos" class="container mx-auto px-4 py-6">
    <h2 class="text-lg font-semibold mb-4">Relatórios Gerados</h2>
    <div id="chartContainer" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"></div>
  </section>

  <script>
    document.getElementById('excelInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(event) {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: "" });
        processarDados(jsonData);
      };
      reader.readAsArrayBuffer(file);
    });

    function processarDados(data) {
      const chartContainer = document.getElementById('chartContainer');
      chartContainer.innerHTML = "";

      const grouped = {};
      data.forEach(row => {
        const tipo = row['Tipo'];
        if (!grouped[tipo]) {
          grouped[tipo] = { labels: [], datasets: {}, grafico: row['Grafico'] || 'bar' };
        }

        const label = row['Categoria'];
        grouped[tipo].labels.push(label);

        Object.keys(row).forEach(col => {
          if (!['Tipo', 'Categoria', 'Grafico'].includes(col)) {
            if (!grouped[tipo].datasets[col]) grouped[tipo].datasets[col] = [];
            grouped[tipo].datasets[col].push(parseFloat(row[col]) || 0);
          }
        });
      });

      Object.entries(grouped).forEach(([titulo, dados], index) => {
        const card = document.createElement('div');
        card.classList.add('bg-white', 'rounded-xl', 'shadow-md', 'p-4', 'w-full', 'aspect-square', 'flex', 'flex-col');
        const canvas = document.createElement('canvas');
        canvas.id = `chart${index}`;
        canvas.classList.add('w-full');
        canvas.style.height = '100%';
        canvas.style.width = '100%';
        card.appendChild(canvas);
        chartContainer.appendChild(card);

        new Chart(canvas.getContext('2d'), {
          type: dados.grafico,
          data: {
            labels: dados.labels,
            datasets: Object.entries(dados.datasets).map(([label, valores], i) => ({
              label,
              data: valores,
              borderColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'][i % 4],
              backgroundColor: 'transparent',
              tension: 0.4
            }))
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: titulo
              }
            },
            scales: {
              y: { beginAtZero: true }
            }
          }
        });
      });
    }
  </script>
</body>
</html>
